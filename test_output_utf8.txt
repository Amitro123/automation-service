============================= test session starts =============================
platform win32 -- Python 3.11.9, pytest-9.0.0, pluggy-1.6.0 -- C:\Users\USER\AppData\Local\Microsoft\WindowsApps\PythonSoftwareFoundation.Python.3.11_qbz5n2kfra8p0\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\USER\AutomationService\automation-service
configfile: pytest.ini
plugins: anyio-4.11.0, logfire-4.14.2, asyncio-1.3.0, cov-7.0.0
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 8 items

tests/test_orchestrator.py::test_run_automation_success PASSED           [ 12%]
tests/test_orchestrator.py::test_run_automation_invalid_payload PASSED   [ 25%]
tests/test_orchestrator.py::test_extract_diff_info_valid FAILED          [ 37%]
tests/test_orchestrator.py::test_extract_diff_info_invalid PASSED        [ 50%]
tests/test_orchestrator.py::test_run_parallel_tasks_success PASSED       [ 62%]
tests/test_orchestrator.py::test_run_parallel_tasks_exception PASSED     [ 75%]
tests/test_orchestrator.py::test_code_review_failure PASSED              [ 87%]
tests/test_orchestrator.py::test_readme_update_skipped PASSED            [100%]

================================== FAILURES ===================================
________________________ test_extract_diff_info_valid _________________________

orchestrator = <automation_agent.orchestrator.AutomationOrchestrator object at 0x000001C4902325D0>

    @pytest.mark.asyncio
    async def test_extract_diff_info_valid(orchestrator):
        payload = {
            "ref": "refs/heads/feature/test",
            "head_commit": {
                "id": "abc1234",
                "message": "fix: bug"
            }
        }
        info = orchestrator._extract_diff_info(payload)
        assert info["commit_sha"] == "abc1234"
>       assert info["branch"] == "feature/test"
E       AssertionError: assert 'test' == 'feature/test'
E         
E         - feature/test
E         + test

tests\test_orchestrator.py:61: AssertionError
=========================== short test summary info ===========================
FAILED tests/test_orchestrator.py::test_extract_diff_info_valid - AssertionEr...
========================= 1 failed, 7 passed in 0.44s =========================
